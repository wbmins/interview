java 基础强化

## 1. 创建对象的六个步骤

- 1.1 判断是否能在常量池中能找到类符号引用，并检查是否已被加载、链接、初始化（即判断类元信息是否存在）

    >> 如果没有则在双亲委派模式下，使用当前类加载器以ClassLoader + 包名 + 类名为Key进行查找对应的.class文件以此来完成类的加载进内存。在这个过程中，要是找不到要加载的类JVM就会抛出ClassNotFoundException异常，意思就是找不到该类进行加载。

- 1.2 为对象分配内存空间

    >> 首先计算对象占用空间大小，接着在堆中划分一块内存给新对象，如果实例成员变量是引用变量，仅分配引用变量空间即可，即4个字节。文章结束附有Java八种基本数据类型的所占字节数，分配内存时根据堆中内存是否规整分为：

    >> ① 内存规整—指针碰撞：如果是规整的，那么虚拟机将采用指针碰撞法来为对象分配内存。
    意思就是所有用过的内存在一边，空闲的内存在另一边，中间放着一个指针作为分界点的指示器，分配内存就仅仅是把指针向空闲那一边挪动一段与对象大小相等的距离，以此来分配内存给对象。如果垃圾收集器选择的是Serial、ParNew这种基于标记 - 压缩算法的，也就是一般使用带有compact（整理）过程的收集器时，就会使用指针碰撞分配方法。

    >> ② 内存不规整—空闲列表：如果内存不是规整的，已使用的内存和未使用的内存相互交错，那么虚拟机将采用这种空闲列表法给对象分配内存。意思就是虚拟机维护了一个列表，记录上哪些内存块是可用的，再分配的时候从列表找到一块足够大的空间划分给对象实例，这种分配方式就是空闲列表（Free List）。

- 1.3 处理并发问题

    >> ① 采用CAS失败重试、区域加锁更新的原子性。

    >> ② 每个线程预先分配一块TLAB区域，可以通过-XX:+ /-UseTLAB参数来设定

- 1.4 初始化分配到的空间（对属性初始化，零值初始化）

    >> 这一过程说白了就是：所有属性设置默认值，保证对象实例字段在不赋值时可以直接使用。基本数据类型默认初始化的值在文章下方表格里。

- 1.5 设置对象的对象头

    >> 将对象的所属类（即类的元数据信息）、对象的HashCode、对象的GC信息、锁信息等数据存储在对象头中。这个过程的具体设置方式取决于JVM实现。

- 1.6 执行init方法进行初始化


    >> 可以简单理解成调用构造函数进行显示的赋值，代码中和构造器中初始化。在Java程序的视角看来，初始化才正式开始，初始化成员变量，显示赋值，执行实例化代码块，调用类的构造器，并把堆内对象的首地址赋值给引用变量。

![总结图片](./img/基础/%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96.jpg)